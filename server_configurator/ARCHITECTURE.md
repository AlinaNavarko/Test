# Архитектура конфигуратора серверов

## Обзор

Конфигуратор серверов построен на основе модульной архитектуры с разделением ответственности между компонентами.

## Основные компоненты системы

### 1. Модели данных (`data_models.py`)

**Назначение:** Определение структур данных для всей системы

**Основные классы:**
- `ComponentType` - Enum типов компонентов (сервер, процессор, память, etc.)
- `Component` - Класс для представления отдельного компонента
- `ComponentAttribute` - Атрибуты компонента (частота, объем, etc.)
- `CompatibilityRule` - Правила совместимости между компонентами
- `ServerConfiguration` - Готовая конфигурация сервера
- `ServerConfiguratorData` - Главный контейнер для всех данных

**Преимущества:**
- Четкое разделение типов данных
- Использование dataclasses для простоты
- Типизация для безопасности кода

### 2. Данные и матрица совместимости (`sample_data.py`)

**Назначение:** Хранение компонентов и правил совместимости

**Два подхода к совместимости:**

#### A. Правила совместимости (CompatibilityRule)
- REQUIRED - обязательный компонент
- EXCLUDED - несовместимые компоненты
- LIMITED - лимиты по количеству
- OPTIONAL - опциональный компонент

#### B. Матрица совместимости
- Быстрый поиск совместимых компонентов
- Двунаправленная проверка совместимости
- Уменьшает количество логики проверки

**Пример матрицы:**
```python
{
    "hp_ml350g4p": [
        "intel_xeon_3_0_604", "intel_xeon_3_2_604",
        "kingston_1gb_ddr2_400", "corsair_2gb_ddr2_533"
    ],
    "intel_xeon_3_0_604": [
        "hp_ml350g4p", "kingston_1gb_ddr2_400", ...
    ]
}
```

### 3. Конфигуратор (`configurator.py`)

**Назначение:** Основная бизнес-логика

**Ключевые функции:**
- `add_component()` - Добавление компонента с проверкой совместимости
- `remove_component()` - Удаление компонента
- `get_available_components()` - Получение доступных компонентов
- `validate_configuration()` - Валидация конфигурации
- `export_configuration()` - Экспорт в JSON/CSV

**Алгоритм проверки совместимости:**
1. Проверка наличия компонента в матрице
2. Проверка совместимости с существующими компонентами
3. Обратная проверка (existing → new)
4. Проверка правил совместимости
5. Возврат списка ошибок

### 4. CLI интерфейс (`cli.py`)

**Назначение:** Командная строка для тестирования

**Основные команды:**
- `list` - список компонентов
- `add` - добавить компонент
- `remove` - удалить компонент
- `config` - показать конфигурацию
- `search` - поиск компонентов
- `compat` - информация о совместимости
- `export` - экспорт конфигурации

### 5. Тесты (`test_configurator.py`)

**Назначение:** Автоматическое тестирование функциональности

**Покрытие:**
- Добавление совместимых компонентов
- Проверка несовместимости
- Лимиты количества
- Валидация конфигурации
- Поиск и экспорт

## Поток данных

```
User Input
    ↓
CLI / API
    ↓
ServerConfigurator
    ↓
┌─────────────────────────┐
│ Проверка совместимости  │
│ 1. Матрица              │
│ 2. Правила              │
└─────────────────────────┘
    ↓
ServerConfiguratorData
    ↓
┌─────────────────────────┐
│ Компоненты              │
│ Правила                 │
│ Категории               │
└─────────────────────────┘
    ↓
Validation & Response
```

## Преимущества архитектуры

### 1. Модульность
- Каждый компонент отвечает за свою задачу
- Легко добавлять новые функции
- Простое тестирование

### 2. Матрица совместимости
- **Быстрый поиск:** O(1) вместо O(n)
- **Меньше логики:** правила в данных, а не в коде
- **Легко расширять:** добавление новых компонентов

### 3. Двунаправленная проверка
- Проверка A → B
- Проверка B → A
- Полная гарантия совместимости

### 4. Гибкость
- Можно использовать только матрицу
- Можно использовать только правила
- Можно комбинировать оба подхода

## Масштабирование

### Для небольших каталогов (< 100 компонентов)
- Текущая архитектура в памяти
- Матрица совместимости в словаре Python
- Достаточно производительно

### Для средних каталогов (100-1000 компонентов)
- SQLite база данных
- Индексированные таблицы для совместимости
- Кэширование часто используемых данных

### Для больших каталогов (> 1000 компонентов)
- PostgreSQL/MySQL
- Таблица compatibility с индексами
- Redis для кэширования
- API для разделения логики

## Пример структуры БД для масштабирования

```sql
-- Components table
CREATE TABLE components (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(255),
    component_type VARCHAR(50),
    manufacturer VARCHAR(100),
    model VARCHAR(100),
    price DECIMAL(10,2),
    availability BOOLEAN
);

-- Attributes table
CREATE TABLE component_attributes (
    id SERIAL PRIMARY KEY,
    component_id VARCHAR(50) REFERENCES components(id),
    name VARCHAR(100),
    value VARCHAR(255),
    unit VARCHAR(20)
);

-- Compatibility matrix
CREATE TABLE compatibility (
    id SERIAL PRIMARY KEY,
    component_id VARCHAR(50) REFERENCES components(id),
    compatible_with VARCHAR(50) REFERENCES components(id),
    UNIQUE(component_id, compatible_with)
);

-- Index for fast lookup
CREATE INDEX idx_compatibility_component ON compatibility(component_id);
CREATE INDEX idx_compatibility_compatible ON compatibility(compatible_with);
```

## Следующие шаги развития

### 1. Веб-интерфейс
- React/Vue.js фронтенд
- REST API на Flask/FastAPI
- Визуальный конструктор

### 2. Расширенная валидация
- Проверка мощности блока питания
- Совместимость размеров (form factor)
- Тепловыделение и охлаждение

### 3. Рекомендательная система
- Автоподбор совместимых компонентов
- Оптимизация по цене/производительности
- Популярные конфигурации

### 4. Интеграция
- Импорт из QuickSpecs
- Парсинг спецификаций производителей
- Синхронизация с прайс-листами

### 5. Расширенные функции
- Сравнение конфигураций
- История изменений
- Сохранение шаблонов
- Калькулятор TCO (Total Cost of Ownership)

## Заключение

Данная архитектура обеспечивает:
- Простоту поддержки
- Легкость расширения
- Высокую производительность
- Надежность проверки совместимости

Использование матрицы совместимости значительно упрощает добавление новых компонентов и уменьшает сложность кода проверки совместимости.
